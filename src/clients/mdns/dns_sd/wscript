import os
import Common
from Params import g_platform

def build(bld):
  obj = bld.create_obj('cc', 'program')
  obj.target = 'xmms2-mdns-dnssd'
  obj.source = ['mdns-dnssd.c']
  obj.includes = '. ../../../include'
  obj.uselib = 'glib2'
  if g_platform != 'darwin':
    obj.uselib += ' dnssd'
  obj.uselib_local = 'xmmsclient-glib xmmsclient'

  obj = bld.create_obj('subst')
  obj.source = 'xmms2-mdns-launcher.sh.in'
  obj.dict = {'PRG_PATH' : os.path.join(bld.env_of_name('default')['PREFIX'], 'bin')}
  Common.install_files('SCRIPTDIR', None, 'xmms2-mdns-launcher.sh', chmod=0755)

def configure(conf):
  if not conf.check_header('dns_sd.h'):
    return False
  if g_platform == 'darwin':
    return True
  else:
    return conf.check_library2('dns_sd', uselib='dnssd', mandatory=0)

def set_options(opt):
  pass
